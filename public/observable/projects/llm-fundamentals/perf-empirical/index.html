<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="generator" content="Observable Framework v1.13.3">
<title>Empirical Performance | Project Writeup Sandbox</title>

<link rel="preload" as="style" href="../../../_import/astro-bridge-theme.255eed1d.css">
<link rel="preload" as="style" href="../../../_npm/katex@0.16.28/dist/katex.min.css">
<link rel="stylesheet" type="text/css" href="../../../_import/astro-bridge-theme.255eed1d.css">
<link rel="stylesheet" type="text/css" href="../../../_npm/katex@0.16.28/dist/katex.min.css">
<link rel="modulepreload" href="../../../_observablehq/client.cbf2d9f3.js">
<link rel="modulepreload" href="../../../_observablehq/runtime.e080113b.js">
<link rel="modulepreload" href="../../../_observablehq/stdlib.43270668.js">
<link rel="modulepreload" href="../../../_import/embed/perf-empirical.6e5843d3.js">
<link rel="modulepreload" href="../../../_observablehq/stdlib/tex.c79b643a.js">
<link rel="modulepreload" href="../../../_import/components/data-utils.e2caa41c.js">
<link rel="modulepreload" href="../../../_import/components/dom-utils.aaca454b.js">
<link rel="modulepreload" href="../../../_import/components/perf-estimates.d771a94d.js">
<link rel="modulepreload" href="../../../_npm/@observablehq/plot@0.6.17/7c43807f.js">
<link rel="modulepreload" href="../../../_npm/d3@7.9.0/e324157d.js">
<link rel="modulepreload" href="../../../_npm/apache-arrow@21.1.0/63de76cd.js">
<link rel="modulepreload" href="../../../_npm/parquet-wasm@0.7.1/68d81b68.js">
<link rel="modulepreload" href="../../../_npm/katex@0.16.28/f76b8a99.js">
<link rel="modulepreload" href="../../../_npm/isoformat@0.2.1/18cbf477.js">
<link rel="modulepreload" href="../../../_npm/interval-tree-1d@1.0.4/53fe8176.js">
<link rel="modulepreload" href="../../../_npm/d3-array@3.2.4/e93ca09f.js">
<link rel="modulepreload" href="../../../_npm/d3-axis@3.0.0/0f2de24d.js">
<link rel="modulepreload" href="../../../_npm/d3-brush@3.0.0/65eb105b.js">
<link rel="modulepreload" href="../../../_npm/d3-chord@3.0.1/7ef8fb2e.js">
<link rel="modulepreload" href="../../../_npm/d3-color@3.1.0/aeb57b94.js">
<link rel="modulepreload" href="../../../_npm/d3-contour@4.0.2/1d2aed74.js">
<link rel="modulepreload" href="../../../_npm/d3-delaunay@6.0.4/5ced1d52.js">
<link rel="modulepreload" href="../../../_npm/d3-dispatch@3.0.1/9ba9c7f3.js">
<link rel="modulepreload" href="../../../_npm/d3-drag@3.0.0/4202580c.js">
<link rel="modulepreload" href="../../../_npm/d3-dsv@3.0.1/9cffc2bd.js">
<link rel="modulepreload" href="../../../_npm/d3-ease@3.0.1/cdd7e898.js">
<link rel="modulepreload" href="../../../_npm/d3-fetch@3.0.1/b4e2ad9a.js">
<link rel="modulepreload" href="../../../_npm/d3-force@3.0.0/5e804d15.js">
<link rel="modulepreload" href="../../../_npm/d3-format@3.1.2/3785bf2d.js">
<link rel="modulepreload" href="../../../_npm/d3-geo@3.1.1/40599fb3.js">
<link rel="modulepreload" href="../../../_npm/d3-hierarchy@3.1.2/e49e792c.js">
<link rel="modulepreload" href="../../../_npm/d3-interpolate@3.0.1/8d1e5425.js">
<link rel="modulepreload" href="../../../_npm/d3-path@3.1.0/20d3f133.js">
<link rel="modulepreload" href="../../../_npm/d3-polygon@3.0.1/7553081f.js">
<link rel="modulepreload" href="../../../_npm/d3-quadtree@3.0.1/0dfd751c.js">
<link rel="modulepreload" href="../../../_npm/d3-random@3.0.1/3c90ee06.js">
<link rel="modulepreload" href="../../../_npm/d3-scale@4.0.2/720b7f0a.js">
<link rel="modulepreload" href="../../../_npm/d3-scale-chromatic@3.1.0/ba24c2e7.js">
<link rel="modulepreload" href="../../../_npm/d3-selection@3.0.0/4d94e5b7.js">
<link rel="modulepreload" href="../../../_npm/d3-shape@3.2.0/6d3a6726.js">
<link rel="modulepreload" href="../../../_npm/d3-time@3.1.0/9f03c579.js">
<link rel="modulepreload" href="../../../_npm/d3-time-format@4.1.0/07c9626f.js">
<link rel="modulepreload" href="../../../_npm/d3-timer@3.0.1/b58a267d.js">
<link rel="modulepreload" href="../../../_npm/d3-transition@3.0.1/004da2ac.js">
<link rel="modulepreload" href="../../../_npm/d3-zoom@3.0.0/b5786b3f.js">
<link rel="modulepreload" href="../../../_npm/tslib@2.8.1/b62a9c4a.js">
<link rel="modulepreload" href="../../../_npm/flatbuffers@25.9.23/c82700c2.js">
<link rel="modulepreload" href="../../../_npm/binary-search-bounds@2.0.5/cbf6ba23.js">
<link rel="modulepreload" href="../../../_npm/internmap@2.0.3/e08981d9.js">
<link rel="modulepreload" href="../../../_npm/delaunator@5.0.1/02d43215.js">
<link rel="modulepreload" href="../../../_npm/robust-predicates@3.0.2/aa00730b.js">
<script type="module">

import {define} from "../../../_observablehq/client.cbf2d9f3.js";
import {registerFile} from "../../../_observablehq/stdlib.43270668.js";

registerFile("../../../data/raw/benchmarks/gpu_comp_history.parquet", {"name":"../../../data/raw/benchmarks/gpu_comp_history.parquet","path":"../../../_file/data/raw/benchmarks/gpu_comp_history.4a516c8a.parquet","lastModified":1770927469233,"size":189583});
registerFile("../../../data/raw/benchmarks/gpu_comp_main.parquet", {"name":"../../../data/raw/benchmarks/gpu_comp_main.parquet","path":"../../../_file/data/raw/benchmarks/gpu_comp_main.8b657d6c.parquet","lastModified":1770927469234,"size":26614});
registerFile("../../../data/raw/benchmarks/micro_benchmarks_20260126_130256.json", {"name":"../../../data/raw/benchmarks/micro_benchmarks_20260126_130256.json","mimeType":"application/json","path":"../../../_file/data/raw/benchmarks/micro_benchmarks_20260126_130256.0003d6fe.json","lastModified":1770920604377,"size":2403});
registerFile("../../../data/raw/benchmarks/mps_comp_history.parquet", {"name":"../../../data/raw/benchmarks/mps_comp_history.parquet","path":"../../../_file/data/raw/benchmarks/mps_comp_history.81dcba33.parquet","lastModified":1770927469238,"size":220323});
registerFile("../../../data/raw/benchmarks/mps_comp_main.parquet", {"name":"../../../data/raw/benchmarks/mps_comp_main.parquet","path":"../../../_file/data/raw/benchmarks/mps_comp_main.ccc27b69.parquet","lastModified":1770927469238,"size":25521});
registerFile("../../../data/raw/benchmarks/train_benchmark_20260127_092323.json", {"name":"../../../data/raw/benchmarks/train_benchmark_20260127_092323.json","mimeType":"application/json","path":"../../../_file/data/raw/benchmarks/train_benchmark_20260127_092323.e80aa474.json","lastModified":1770920604379,"size":1945563});

define({id: "e9422d4d", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`B`
))
}});

define({id: "292babb6", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`S`
))
}});

define({id: "d4a5728a", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`d_{model}`
))
}});

define({id: "276a7cec", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`d_k`
))
}});

define({id: "de8b04bb", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`h`
))
}});

define({id: "ae05f8da", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`h = d_{model} / d_k`
))
}});

define({id: "256dca58", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`L`
))
}});

define({id: "f3dc34f5", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`d_{ff}`
))
}});

define({id: "1be1b6c7", outputs: ["renderPerfEmpiricalTrainBenchmark","renderPerfEmpiricalExpectedVsActual","renderPerfEmpiricalDeviceComparison","renderPerfEmpiricalTrainingCurves"], body: async () => {
const {renderPerfEmpiricalTrainBenchmark, renderPerfEmpiricalExpectedVsActual, renderPerfEmpiricalDeviceComparison, renderPerfEmpiricalTrainingCurves} = await import("../../../_import/embed/perf-empirical.6e5843d3.js");

return {renderPerfEmpiricalTrainBenchmark,renderPerfEmpiricalExpectedVsActual,renderPerfEmpiricalDeviceComparison,renderPerfEmpiricalTrainingCurves};
}});

define({id: "5f0c9453", inputs: ["renderPerfEmpiricalTrainBenchmark"], outputs: ["trainSection"], body: async (renderPerfEmpiricalTrainBenchmark) => {
const trainSection = await renderPerfEmpiricalTrainBenchmark();
return {trainSection};
}});

define({id: "03091ea1", inputs: ["display","trainSection"], body: (display,trainSection) => {
display(trainSection);
}});

define({id: "d4a5728a-1", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`d_{model}`
))
}});

define({id: "8664f8c5", mode: "inline", inputs: ["tex","display"], body: async (tex,display) => {
display(await(
tex`S^2`
))
}});

define({id: "78359219", inputs: ["renderPerfEmpiricalExpectedVsActual"], outputs: ["evaSection"], body: async (renderPerfEmpiricalExpectedVsActual) => {
const evaSection = await renderPerfEmpiricalExpectedVsActual();
return {evaSection};
}});

define({id: "100de579", inputs: ["display","evaSection"], body: (display,evaSection) => {
display(evaSection);
}});

define({id: "67bfe76d", inputs: ["renderPerfEmpiricalDeviceComparison"], outputs: ["compSection"], body: async (renderPerfEmpiricalDeviceComparison) => {
const compSection = await renderPerfEmpiricalDeviceComparison();
return {compSection};
}});

define({id: "9996ac78", inputs: ["display","compSection"], body: (display,compSection) => {
display(compSection);
}});

define({id: "9dd16f38", inputs: ["renderPerfEmpiricalTrainingCurves"], outputs: ["curvesSection"], body: async (renderPerfEmpiricalTrainingCurves) => {
const curvesSection = await renderPerfEmpiricalTrainingCurves();
return {curvesSection};
}});

define({id: "9924402b", inputs: ["display","curvesSection"], body: (display,curvesSection) => {
display(curvesSection);
}});

</script>
</head>
<body>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="../../../">Project Writeup Sandbox</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="../../">Projects</a></li>
    <li class="observablehq-link"><a href="../">LLM Fundamentals</a></li>
    <li class="observablehq-link"><a href="../../data-playground/">Data Playground</a></li>
  </ol>
</nav>
<script>{const e=document.querySelector("#observablehq-sidebar"),o=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?o.checked=r==="true":o.indeterminate=!0;for(const t of document.querySelectorAll("#observablehq-sidebar summary")){const s=t.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${t.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<div id="observablehq-center">
<header id="observablehq-header">
<nav class="portfolio-top-links"><a class="portfolio-nav-link" href="../../../" onclick="event.preventDefault(); window.location.assign(window.location.origin + '/');">Home</a><a class="portfolio-nav-link" href="../../" onclick="event.preventDefault(); const mount = window.location.pathname.startsWith('/observable/') ? '/observable' : ''; window.location.assign(window.location.origin + mount + '/projects/');">Projects</a><a id="portfolio-current-project-link" class="portfolio-nav-link" href="../" onclick="event.preventDefault(); const mount = window.location.pathname.startsWith('/observable/') ? '/observable' : ''; const path = window.location.pathname.replace(/^\/observable(?=\/|$)/, ''); const llm = /^\/projects\/llm-fundamentals(\/|$)/.test(path); const playground = /^\/projects\/data-playground(\/|$)/.test(path); const target = llm ? '/projects/llm-fundamentals/' : (playground ? '/projects/data-playground/' : '/projects/'); window.location.assign(window.location.origin + mount + target);">Current Project</a></nav><script>(function(){const path=window.location.pathname.replace(/^\/observable(?=\/|$)/,""); const link=document.getElementById("portfolio-current-project-link"); if(link && /^\/projects\/?$/.test(path)){link.remove();} for(const id of ["observablehq-sidebar-toggle","observablehq-sidebar-backdrop","observablehq-sidebar"]){const node=document.getElementById(id); if(node) node.remove();}})();</script>
</header>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#benchmark-grid-search">Benchmark Grid Search</a></li>
<li class="observablehq-secondary-link"><a href="#model-selection">Model Selection</a></li>
<li class="observablehq-secondary-link"><a href="#2-controlled-platform-comparison-mps-comp-vs-gpu-comp">2) Controlled Platform Comparison (mps_comp vs gpu_comp)</a></li>
<li class="observablehq-secondary-link"><a href="#3-training-curve-analysis">3) Training-Curve Analysis</a></li>
</ol>
</nav>
</aside>
<main id="observablehq-main" class="observablehq">
<h1 id="benchmarks-and-empirical-performance-analysis" tabindex="-1"><a class="observablehq-header-anchor" href="#benchmarks-and-empirical-performance-analysis">Benchmarks and Empirical Performance Analysis</a></h1>
<h2 id="introduction" tabindex="-1"><a class="observablehq-header-anchor" href="#introduction">Introduction</a></h2>
<p>Benchmarking work in this project was centered around pedagogic goals, which were twofold.  First, was simply gaining familiarity with benchmarking tools.  To this end, the PyTorch <code>blocked_autorange</code> method from the <code>benchmark.Timer</code> class was initially used to execute a controlled, large-scale grid search across core model parameters (see below).</p>
<p>These results were then used to generate more robustly estimate model specifications that could be run on the avialable hardware, culminating in two model settings being selected for comparison, one "wide" and another "deep", a relativley standard kind of comparison.  These two models had similar numbers of parameters and compute budgets, but differed on memory use.</p>
<p>After training on the Apple M4, the two models were then trained on the RTX 4090.  This analysis concludes with a comparison of training performance between these two systems, after which we provide sample output from the final model weights.</p>
<h2 id="benchmark-grid-search" tabindex="-1"><a class="observablehq-header-anchor" href="#benchmark-grid-search">Benchmark Grid Search</a></h2>
<p>The first step in benchmarking was a grid search across core models parameters, including</p>
<ul>
<li>bach size <observablehq-loading></observablehq-loading><!--:e9422d4d:--></li>
<li>sequence length <observablehq-loading></observablehq-loading><!--:292babb6:--></li>
<li>model dimension <observablehq-loading></observablehq-loading><!--:d4a5728a:--></li>
<li>head dimension <observablehq-loading></observablehq-loading><!--:276a7cec:--> or number of heads <observablehq-loading></observablehq-loading><!--:de8b04bb:--> (with <observablehq-loading></observablehq-loading><!--:ae05f8da:-->, and locked to multiples of 32)</li>
<li>number of layers/blocks <observablehq-loading></observablehq-loading><!--:256dca58:--></li>
<li>SwiGLU network feedforward dimension <observablehq-loading></observablehq-loading><!--:f3dc34f5:--></li>
</ul>
<p>As the <code>benchmark.Timer</code> class primarily measures time and throughput, those are the metrics collected.  The <code>blocked_autorange</code> method was used on a single training loop iteration, with the expectation that this would result in reliable and repeatable results.  While this is true in the sense that the method does ensure that the memory space is clean and that the device has been synchronized, part of the method's reliability comes from the repeated execution of the code under study, and in this case the minimum time allotted was often lower than the time of a single run.  Nonetheless, the data were consistent with expectations, as can be seen below.</p>
<div class="observablehq observablehq--block"><!--:1be1b6c7:--></div>
<div class="observablehq observablehq--block"><!--:5f0c9453:--></div>
<div class="observablehq observablehq--block"><!--:03091ea1:--></div>
<h4 id="observations" tabindex="-1"><a class="observablehq-header-anchor" href="#observations">Observations</a></h4>
<ul>
<li>the data were not especially noisy, indicating the benchmark library functioned as desired</li>
<li>smaller <observablehq-loading></observablehq-loading><!--:d4a5728a-1:--> lead to higher tokens/sec</li>
<li>larger sequence lengths quickly exceed memory capacity (<observablehq-loading></observablehq-loading><!--:8664f8c5:--> curse)</li>
<li>batch size helps smaller models effectively maintain high throughput</li>
</ul>
<h3 id="expected-vs-actual-performance" tabindex="-1"><a class="observablehq-header-anchor" href="#expected-vs-actual-performance">Expected vs Actual Performance</a></h3>
<p>It's important to note that these are "expected" in the sense of "calculated based on listed system TFLOPs" rather than any more nuanced estimation.  As such, performance is always worse than "expected", with the line on the following charts reflecting the point where actual and expected would have been equal.</p>
<div class="observablehq observablehq--block"><!--:78359219:--></div>
<div class="observablehq observablehq--block"><!--:100de579:--></div>
<h4 id="observations-1" tabindex="-1"><a class="observablehq-header-anchor" href="#observations-1">Observations</a></h4>
<ul>
<li>memory issues arise in large models, causing an explosive growth in observed iteration time when the system becomes stressed</li>
<li></li>
</ul>
<h3 id="conclusions" tabindex="-1"><a class="observablehq-header-anchor" href="#conclusions">Conclusions</a></h3>
<p>The observations broadly reflects expectations.  The modifier "broadly" is used because there is a persistent level of uncertainty associated with Apple Silicon and the MacOS/MPS stack: the system is heavily memory-bottlenecked yet also suffers from a poorly optimized stack that requires numerous MPS kernel launces, increasing overhead.</p>
<p>In fact both are true, so increasing batch size in smaller models does lead to improved throughput, while larger models do bog down the system and show increasingly sub-optimal performance.</p>
<h2 id="model-selection" tabindex="-1"><a class="observablehq-header-anchor" href="#model-selection">Model Selection</a></h2>
<hr>
<h2 id="2-controlled-platform-comparison-mps-comp-vs-gpu-comp" tabindex="-1"><a class="observablehq-header-anchor" href="#2-controlled-platform-comparison-mps-comp-vs-gpu-comp">2) Controlled Platform Comparison (<code>mps_comp</code> vs <code>gpu_comp</code>)</a></h2>
<h3 id="device-comparison-summary" tabindex="-1"><a class="observablehq-header-anchor" href="#device-comparison-summary">Device Comparison Summary</a></h3>
<p>This section compares matched deep/wide model variants across MPS and CUDA
using the parquet summaries and derived speedup tables.</p>
<div class="observablehq observablehq--block"><!--:67bfe76d:--></div>
<div class="observablehq observablehq--block"><!--:9996ac78:--></div>
<hr>
<h2 id="3-training-curve-analysis" tabindex="-1"><a class="observablehq-header-anchor" href="#3-training-curve-analysis">3) Training-Curve Analysis</a></h2>
<p>Curves are rendered per run/platform series with stride and gap controls to
avoid misleading joins through missing values.</p>
<h3 id="training-curves" tabindex="-1"><a class="observablehq-header-anchor" href="#training-curves">Training Curves</a></h3>
<div class="observablehq observablehq--block"><!--:9dd16f38:--></div>
<div class="observablehq observablehq--block"><!--:9924402b:--></div>
<hr>
<h3 id="notes-on-diagnostic-benchmarks" tabindex="-1"><a class="observablehq-header-anchor" href="#notes-on-diagnostic-benchmarks">Notes on Diagnostic Benchmarks</a></h3>
<p><code>micro_benchmarks</code> and <code>sequential_benchmark</code> were diagnostic runs used to
debug a memory-fragmentation issue and are intentionally omitted from the main
analysis narrative here.</p>
</main>
<footer id="observablehq-footer">
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2026-02-17T23:24:39">Feb 17, 2026</a>.</div>
</footer>
</div>
</body>
</html>
